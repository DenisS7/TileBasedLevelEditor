<UserControl x:Class="TileBasedLevelEditor.Views.TileGrid"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:TileBasedLevelEditor.Views"
             xmlns:misc="clr-namespace:TileBasedLevelEditor.Misc"
             xmlns:vm="clr-namespace:TileBasedLevelEditor.ViewModels" d:DataContext="{d:DesignInstance Type=vm:TileGridViewModel}"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </UserControl.Resources>

    <Grid>
        <ScrollViewer Background="DimGray"
                      VerticalScrollBarVisibility="Auto" 
                      HorizontalScrollBarVisibility="Auto" 
                      Padding="1, 1, 0 , 0"
                      Name="TilesetBorder">
            <Border BorderThickness="0">
                <Canvas misc:TileSelector.HoverCommand="{Binding HoverTileCommand}"
                        misc:TileSelector.SelectCommand="{Binding SelectTileCommand}">

                    <ItemsControl ItemsSource="{Binding TileImages}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="{Binding NrTiles.X}"
                                             Rows="{Binding NrTiles.Y}"
                                             Background="Transparent"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Image Source="{Binding}"
                                           Margin="{Binding DataContext.ThicknessTileMargin, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <Rectangle Width="{Binding TileSize.X}"
                               Height="{Binding TileSize.Y}"
                               Visibility="{Binding IsTileHovered, Converter={StaticResource BoolToVis}}"
                               Opacity="0.3"
                               Fill="Aqua"
                               IsHitTestVisible="False"
                               Canvas.Left="{Binding HoveredTileLocation.X}"
                               Canvas.Top="{Binding HoveredTileLocation.Y}"/>

                    <Rectangle Width="{Binding TileSize.X}"
                               Height="{Binding TileSize.Y}"
                               Visibility="{Binding IsTileSelected, Converter={StaticResource BoolToVis}}"
                               Opacity="0.3"
                               Fill="DeepSkyBlue"
                               IsHitTestVisible="False"
                               Canvas.Left="{Binding SelectedTileLocation.X}"
                               Canvas.Top="{Binding SelectedTileLocation.Y}"/>
                </Canvas>
            </Border>
        </ScrollViewer>
    </Grid>
</UserControl>
